{"name":"Share Hotbar","type":"script","author":"SI95pbXQG40qzDAu","img":"icons/magic/time/arrows-circling-pink.webp","scope":"global","command":"// This script must be run by a GM!\n\nfunction shareHotbar(currentUser) {\n    const userIds = Array.from(game.users.keys()).filter(id => id !== currentUser.id);\n    const users = userIds\n        .map(id => game.users.get(id))\n        .map(u => { return { id: u.id, name: u.name } });\n\n    const actorsWithHotbarIds = Object.keys(currentUser.getFlag(\"token-hotbar\", \"hotbar\"));\n    const actors = actorsWithHotbarIds\n        .map(id => game.actors.get(id))\n        .filter(x => x)\n        .map(actor => { return { id: actor.id, name: actor.name } });\n\n    const actorOptions = actors.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`, ``);\n    const userOptions = users.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`, ``);\n\n    const content = `<form>\n        <div class=\"form-group\">\n            <label>User:</label>\n            <select name=\"user\">${userOptions}</select>\n        </div>\n        <div class=\"form-group\">\n            <label>Actor:</label>\n            <select name=\"actor\">${actorOptions}</select>\n        </div>\n    </form`;\n\n    function shareHotbarCallback(html) {\n        const userId = html.find('[name=\"user\"]')[0].value;\n        const actorId = html.find('[name=\"actor\"]')[0].value;\n        console.log('Token Hotbar | MACRO | ', { userId, actorId });\n\n        const hotbar = currentUser.getFlag('token-hotbar', `hotbar.${actorId}`);\n        const receivingUser = game.users.get(userId);\n        const regardingActor = game.actors.get(actorId);\n\n        console.log('Token Hotbar | MACRO | ', { hotbar, receivingUser, regardingActor });\n        window['token-hotbar'].saveHotbar(hotbar, receivingUser, regardingActor);\n    }\n\n    let d = new Dialog({\n        title: \"Share Hotbar\",\n        content: content,\n        buttons: {\n            share: {\n                icon: '<i class=\"fas fa-check\"></i>',\n                label: \"Share\",\n                callback: shareHotbarCallback\n            },\n            cancel: {\n                icon: '<i class=\"fas fa-times\"></i>',\n                label: \"Cancel\"\n            }\n        },\n        default: \"cancel\"\n    });\n\n    d.render(true);\n}\n\n// Replace `game.user` with `game.users.get(otherUserId)` to share another\n// user's hotbar instead of yours.\nshareHotbar(game.user);","folder":null,"sort":0,"permission":{"default":0,"SI95pbXQG40qzDAu":3},"flags":{"core":{"sourceId":"Macro.pXuZLbRnaG4cyIfA"}},"_id":"klRFtzXwZ2W6EgFO"}
