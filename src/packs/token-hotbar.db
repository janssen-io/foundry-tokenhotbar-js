{"name":"Share Hotbar No API","type":"script","author":"YC4qwAhkNmOeMXnQ","img":"icons/magic/time/arrows-circling-pink.webp","scope":"global","command":"// This script must be run by a GM!\n\nfunction shareHotbar(currentUser) {\n    const userIds = Array.from(game.users.keys()).filter(id => id !== currentUser.id);\n    const users = userIds\n        .map(id => game.users.get(id))\n        .map(u => { return { id: u.id, name: u.name } });\n\n    const actorsWithHotbarIds = Object.keys(getProperty(currentUser.flags,\"token-hotbar\"));\n    const actors = actorsWithHotbarIds\n        .map(id => game.actors.get(id))\n        .filter(x => x)\n        .map(actor => { return { id: actor.id, name: actor.name } });\n\n    const actorOptions = actors.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`, ``);\n    const userOptions = users.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`, ``);\n\n    const content = `<form>\n        <div class=\"form-group\">\n            <label>User:</label>\n            <select name=\"user\">${userOptions}</select>\n        </div>\n        <div class=\"form-group\">\n            <label>Actor:</label>\n            <select name=\"actor\">${actorOptions}</select>\n        </div>\n    </form`;\n\n    function shareHotbarCallback(html) {\n        const userId = html.find('[name=\"user\"]')[0].value;\n        const actorId = html.find('[name=\"actor\"]')[0].value;\n        console.log('Token Hotbar | MACRO | ', { userId, actorId });\n\n        const hotbar = currentUser.getFlag('token-hotbar', `${actorId}`);\n        const receivingUser = game.users.get(userId);\n        const regardingActor = game.actors.get(actorId);\n\n        console.log('Token Hotbar | MACRO | ', { hotbar, receivingUser, regardingActor });\n        game.modules.get('token-hotbar').api.saveHotbar(hotbar, receivingUser, regardingActor);\n    }\n\n    let d = new Dialog({\n        title: \"Share Hotbar\",\n        content: content,\n        buttons: {\n            share: {\n                icon: '<i class=\"fas fa-check\"></i>',\n                label: \"Share\",\n                callback: shareHotbarCallback\n            },\n            cancel: {\n                icon: '<i class=\"fas fa-times\"></i>',\n                label: \"Cancel\"\n            }\n        },\n        default: \"cancel\"\n    });\n\n    d.render(true);\n}\n\n// Replace `game.user` with `game.users.get(otherUserId)` to share another\n// user's hotbar instead of yours.\nshareHotbar(game.user);","flags":{"core":{"sourceId":"Macro.pXuZLbRnaG4cyIfA"}},"ownership":{"default":0,"YC4qwAhkNmOeMXnQ":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.286","createdTime":1664566626476,"modifiedTime":1664568108406,"lastModifiedBy":"YC4qwAhkNmOeMXnQ"},"folder":null,"sort":0,"_id":"0bhnJ2e5nPmmWKGu"}
{"name":"Share Hotbar API","type":"script","author":"YC4qwAhkNmOeMXnQ","img":"icons/magic/time/arrows-circling-pink.webp","scope":"global","command":"function main(){\n     const apin = game.modules.get('token-hotbar').api;\n     const userId = game.user.id; \n     apin.shareHotbar(userId);\n}\nmain();","flags":{"core":{"sourceId":"Macro.pXuZLbRnaG4cyIfA"}},"ownership":{"default":0,"YC4qwAhkNmOeMXnQ":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.286","createdTime":1664565725380,"modifiedTime":1664568107517,"lastModifiedBy":"YC4qwAhkNmOeMXnQ"},"folder":null,"sort":0,"_id":"QTlS1dJkwDNApgd5"}
